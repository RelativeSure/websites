name: Mirror to Codeberg

on:
  push:
    branches:
      - master
  schedule:
    # Run once every day at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  mirror:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Full history for complete mirror

      - name: Mirror to Codeberg
        env:
          CODEBERG_USERNAME: ${{ secrets.CODEBERG_USERNAME }}
          CODEBERG_TOKEN: ${{ secrets.CODEBERG_TOKEN }}
          CODEBERG_REPO: ${{ secrets.CODEBERG_REPO }}
        run: |
          set -e
          git remote remove codeberg 2>/dev/null || true
          git remote add codeberg "https://${CODEBERG_USERNAME}:${CODEBERG_TOKEN}@codeberg.org/${CODEBERG_USERNAME}/${CODEBERG_REPO}.git"
          git push --force --all codeberg
          git push --force --tags codeberg

# Required secrets:
# - CODEBERG_USERNAME: Your Codeberg username
# - CODEBERG_TOKEN: Codeberg access token with repository write permissions
# - CODEBERG_REPO: Name of the target repository on Codeberg
